:root{
  --paper:#f6f1e4; --ink:#2a2a2a; --frame:#fffdf7; --accent:#2f7d32; --muted:#555;
  --shadow:0 10px 0 rgba(0,0,0,.08);
  --barbg:rgba(0,0,0,.08); --barstroke:rgba(0,0,0,.15);
  --rainbow: linear-gradient(90deg,#ff6b6b 0%,#ffb86b 18%,#ffd166 32%,#b6e36e 46%,#7bd0b2 60%,#76a9fa 76%,#b388ff 100%);
}
.dark{
  --paper:#0f1214; --ink:#e9e9e9; --frame:#12171c; --accent:#7ed957; --muted:#a9b0b6;
  --shadow:0 10px 0 rgba(0,0,0,.35);
  --barbg:rgba(255,255,255,.18); --barstroke:rgba(255,255,255,.25);
}

*{box-sizing:border-box}
html,body{height:100%}
body.paper{ margin:0; color:var(--ink); background:var(--paper);
  font-family:'Quicksand', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  overflow:hidden;
}
body.paper::before{
  content:""; position:fixed; inset:0; pointer-events:none;
  background-image: radial-gradient(rgba(0,0,0,.03) 1px, transparent 1px),
                   radial-gradient(rgba(0,0,0,.02) 1px, transparent 1px);
  background-position: 0 0, 12px 8px; background-size: 16px 16px, 16px 16px;
  mix-blend-mode:multiply; opacity:.5;
}
.dark.paper::before{opacity:.15}

/* Progress */
.progress-wrap{height:8px; background:var(--barbg); margin:10px; border-radius:8px; border:1px solid var(--barstroke)}
.progress-bar{height:8px; width:0%; background:var(--rainbow); border-radius:8px; transition:width .25s ease}
.presenting .progress-wrap{ display:none !important; }

/* Deck */
#deck{ height:calc(100svh - 50px); padding:14px; outline:none; position:relative; }
.presenting #deck{ position:fixed; inset:0; padding:0; height:100svh; width:100vw; overflow:hidden; }

/* Slides */
.slide{ display:none; position:absolute; inset:0; height:100%; overflow:hidden; padding:10px; align-items:flex-start; justify-content:center; }
.slide.current{ display:flex; }
.presenting .slide{ padding:0; }

/* Transitions */
.slide.current.anim-right{ animation: enterRight .45s cubic-bezier(.22,1,.36,1) both; }
.slide.current.anim-left{  animation: enterLeft  .45s cubic-bezier(.22,1,.36,1) both; }
@keyframes enterRight{ from{opacity:0; transform:translateX(36px)} to{opacity:1; transform:none} }
@keyframes enterLeft { from{opacity:0; transform:translateX(-36px)} to{opacity:1; transform:none} }

/* Frame */
.inner{ max-width:1100px; margin:0 auto; padding:1.1rem; transform-origin:center top; }
.center{text-align:center}
.poster-frame{ background:var(--frame); border:6px solid var(--ink); border-radius:26px; box-shadow: var(--shadow); }
.inner.poster-frame{ position:relative }
.inner.poster-frame::after{ content:""; position:absolute; inset:10px; border:2px solid rgba(0,0,0,.25); border-radius:20px; pointer-events:none; }
.dark .inner.poster-frame::after{ border-color: rgba(255,255,255,.18); }

/* Showcase image */
.showcase .inner.poster-frame{ padding:4px; border-width:5px; }
.showcase .inner.poster-frame::after{ display:none; }
.fullbleed-max{ margin:0; height:100%; }
.fullbleed-max img{ display:block; width:100%; height:min(92vh, 98svh); object-fit:contain; border-radius:18px; background:#fff; border:0; box-shadow:none; }
.dark .fullbleed-max img{ background:#0e1418; }

/* Text */
.titlecard h1{ font-family:'Fredoka'; font-weight:700; font-size:2.8rem; line-height:1.05; margin:.2rem 0 .25rem; }
.titlecard h1::after{ content:""; display:block; height:10px; margin-top:6px; border-radius:6px; background:var(--rainbow); }
.subtitle{font-family:'Kalam'; font-weight:700; font-size:1.7rem; margin:.2rem 0 .2rem}
.byline{opacity:.95; margin:0 0 .6rem 0; font-weight:700}
.byline .name,.byline .course{display:block}
.hero img{max-height:65vh; width:100%; object-fit:cover; border-radius:18px; background:#fff; border:4px solid var(--ink); box-shadow: 0 6px 0 rgba(0,0,0,.12)}
.dark .hero img{ background:#0e1418; }

/* Grid & media */
.two-up{display:grid; grid-template-columns:1fr 1fr; gap:1rem; align-items:start}
img{max-width:100%; height:auto; border-radius:18px; background:#fff; border:4px solid var(--ink); box-shadow: 0 6px 0 rgba(0,0,0,.12)}
.dark img{ background:#0e1418; }
.sticker{transform:rotate(-0.8deg)}
figcaption{font-size:.9rem; color:var(--muted); margin-top:.35rem}

/* Headings & bullets */
h2{font-family:'Kalam'; font-weight:700; font-size:2rem; margin:.1rem 0 .6rem}
.minihead{font-family:'Kalam'; margin:.1rem 0 .3rem; font-size:1.3rem}
.bullets{list-style:none; padding:0; margin:0 0 1rem 0; font-size:1.08rem}
.bullets li{margin:.5rem 0; padding-left:1.5rem; position:relative}
.bullets li::before{
  content:""; position:absolute; left:0; top:.2rem; width:1.05rem; height:1.05rem;
  background:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%232f7d32' d='M12 2c-1.4 3.7-4.7 6.1-8.7 6.6C5 11.8 8.2 14.3 12 22c3.8-7.7 7-10.2 8.7-13.4C16.7 8.1 13.4 5.7 12 2z'/></svg>") no-repeat center/contain;
}
.tag{ padding:.08rem .4rem; border:2px solid var(--ink); border-radius:999px; background:#fff; font-weight:700; box-shadow:0 2px 0 rgba(0,0,0,.12) }
.dark .tag{ background:#0e1418; }

/* Osmosis viz */
.sim{margin-top:.5rem}
.sim label{display:block; font-weight:700; margin-bottom:.25rem}
.sim input[type=range]{width:100%}
.readout{display:flex; gap:1rem; justify-content:center; margin:.35rem 0 .6rem 0; font-weight:700}
.viz{display:block; width:100%; max-width:580px; margin:.4rem auto}
.sim-note{margin-top:.4rem}

/* Reaction coordinates */
.rc-controls{display:flex; gap:.9rem; flex-wrap:wrap; justify-content:center; align-items:center; margin:.4rem 0 .5rem}
.rc-controls label{font-weight:700}
.btn{border:3px solid var(--ink); background:#fff; border-radius:12px; padding:.2rem .6rem; font-weight:700; cursor:pointer; box-shadow:0 3px 0 rgba(0,0,0,.12)}
.dark .btn{background:#12171c}
.toggle{display:flex; align-items:center; gap:.4rem; font-weight:700}
.rc-readouts{display:flex; gap:1rem; justify-content:center; align-items:center; font-weight:700; margin:.2rem 0 .4rem}
.rc-svg{width:100%; max-width:860px; height:auto; margin:.1rem auto .2rem; display:block}
.axis{font-family:'Kalam'; font-size:16px; fill:var(--ink)}
.label{font-family:'Kalam'; font-size:16px; fill:#333}
.baseline{stroke:#999; stroke-width:3; stroke-dasharray:6 6}
.curve{fill:none; stroke-width:6; filter: drop-shadow(0 2px 0 rgba(0,0,0,.12))}
.curve.uncat{stroke:#7b61ff}
.curve.cat{stroke:#2f7d32}
.hidden{display:none}
.ea-line{stroke:#222; stroke-width:3; stroke-dasharray:6 6}
.ea-arrow{fill:#222}
.ea-text{font-family:'Kalam'; font-size:20px; fill:#222}
.dot{fill:#ff8a00; opacity:.9; animation: climb var(--dotDur,2.2s) linear infinite}
.dot.demo{display:inline-block; width:12px; height:12px; border-radius:50%; background:#ff8a00; margin-right:.4rem; vertical-align:middle}
@keyframes climb{ 0%{transform:translateX(0) translateY(0)} 50%{transform:translateX(220px) translateY(-160px)} 100%{transform:translateX(480px) translateY(20px)} }
.decarb-warn,.lab-warn{ margin:.4rem auto 0; max-width:760px; font-weight:700; color:#c62828 }

/* pH simulator */
.ph-grid{display:grid; grid-template-columns:1fr 1fr; gap:1rem; align-items:start}
.ph-controls label{display:block; font-weight:700; margin-bottom:.25rem}
.ph-controls input[type=range]{width:100%}
.ph-bars{width:100%; max-width:520px; margin:0 auto}
.bar-row{display:flex; align-items:center; gap:.6rem; margin:.25rem 0}
.bar-label{width:32px; text-align:right; font-weight:700}
.bar-track{flex:1; height:18px; border:3px solid var(--ink); border-radius:12px; background:#fff; overflow:hidden; box-shadow:0 2px 0 rgba(0,0,0,.12)}
.dark .bar-track{background:#12171c}
.bar-fill{height:100%; width:40%; background:var(--rainbow);}

/* Freezing point sim */
.fpd-grid{display:grid; grid-template-columns:1fr 1fr; gap:1rem; align-items:center}
.fpd-controls label{display:block; font-weight:700; margin-bottom:.25rem}
.fpd-controls input[type=range]{width:100%}
.smallbar{max-width:360px}
.conv-bar-bg{fill:#e9eef3; stroke:#222; stroke-width:3}
.conv-bar-fg{fill:url(#g1); }
.conv-bar-fg{ fill:#76a9fa; } /* solid fallback */

/* Lab (Decarb) layout */
.lab-grid{display:grid; grid-template-columns:320px 1fr; gap:1rem; align-items:start}
.lab-controls label{display:block; font-weight:700; margin:.35rem 0 .15rem}
.lab-controls input[type=range]{width:100%}
.preset-row,.play-row{display:flex; gap:.5rem; flex-wrap:wrap; margin-bottom:.25rem}
.readouts{display:grid; grid-template-columns:1fr 1fr; gap:.35rem .75rem; margin-top:.4rem; text-align:left; max-width:320px}
.lab-viz{min-width:0}
.lab-svg{width:100%; max-width:860px; height:auto; margin:.1rem auto .2rem; display:block}
.legend{font-size:.95rem; margin-top:.25rem}

/* Property table */
.prop-table{ width:100%; border-collapse:separate; border-spacing:0; margin:.4rem 0; }
.prop-table th, .prop-table td{ border:3px solid var(--ink); padding:.35rem .5rem; text-align:left; }
.prop-table thead th{ background:#fff; font-family:'Kalam'; }
.prop-table tr:first-child th:first-child{ border-top-left-radius:12px; }
.prop-table tr:first-child th:last-child{ border-top-right-radius:12px; }
.prop-table tr:last-child td:first-child{ border-bottom-left-radius:12px; }
.prop-table tr:last-child td:last-child{ border-bottom-right-radius:12px; }
.dark .prop-table thead th{ background:#12171c; }

/* References */
.refs .ref-list{max-height:62vh; overflow:auto; padding-right:.5rem; text-align:left}
.presenting .refs .ref-list{ max-height:none; overflow:visible; }

/* Footer */
.help{ position:fixed; left:0; right:0; bottom:0; padding:.35rem .8rem; background:#fff; font-size:.9rem; text-align:center; border-top:3px solid var(--ink) }
.dark .help{ background:#12171c; }
.presenting .help{ display:none !important; }

/* Happy Growing */
.happy{ margin-top:.6rem; font-family:'Kalam', cursive; font-weight:700; text-align:center; letter-spacing:.8px; }

/* Glossary modal */
.modal[hidden]{display:none}
.modal{position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; z-index:50}
.glossary-wrap{max-width:720px; margin:auto; padding:1rem; background:var(--frame); position:relative}
.glossary-wrap .close{position:absolute; top:.6rem; right:.6rem; border:3px solid var(--ink); background:#fff; border-radius:10px; padding:.2rem .45rem; cursor:pointer}
.dark .glossary-wrap .close{ background:#12171c; }
.glossary-wrap h3{font-family:'Fredoka'; margin:.3rem 0 .6rem; text-align:center}
.glossary-wrap dl{display:grid; grid-template-columns:1fr 2fr; gap:.4rem .8rem}

/* Handout / Print */
.handout .progress-wrap, .handout .modal{ display:none !important; }
.handout #deck{ height:auto; padding:20px; }
.handout .slide{ display:block !important; position:static; height:auto; overflow:visible; margin: 0 auto 24px; }
.handout .inner{ transform:none !important; margin-top:0 !important; }
.handout .inner.poster-frame::after{ display:none; }
@media print{
  :root{ print-color-adjust:exact; -webkit-print-color-adjust:exact; }
  body{ background:#fff; color:#000 }
  .help, .progress-wrap, .modal{ display:none !important; }
  #deck{ height:auto; padding:0; position:static }
  .slide{ display:block !important; position:static; height:auto; overflow:visible; page-break-after:always; }
  .inner{ transform:none !important; margin-top:0 !important; }
  .inner.poster-frame{ box-shadow:none; }
  .inner.poster-frame::after{ display:none; }
}
